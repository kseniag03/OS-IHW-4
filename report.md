#  ИДЗ №4 #
## Markdown report <br> ##

### 1. Ганина Ксения Андреевна 212 (тг для вопросов: @kgnn47) <br> ###
### 2. Вариант-21 <br> ###

![image](https://github.com/kseniag03/OS-IHW-4/assets/114473740/64db0a49-c50c-4062-bc81-a17c0723ad51)
![image](https://github.com/kseniag03/OS-IHW-3/assets/114473740/e8ead5cf-0696-4d48-9ba4-db46f0239a00)
________________________

### 3. Содержание отчёта и нюансы <br> ###

Структура отчёта аналогична отчёту ИДЗ-3. Ознакомиться с логикой передачи данных можно [по ссылке](https://github.com/kseniag03/OS-IHW-3/blob/master/report.md) <br> Описанные там сценарии работы актуальны. В данном отчёте будет показана смена протокола.


Каждый следующий раздел содержит сценарий решаемой задачи, нюансы к коду и ссылки на соответствующий код <br>
Раздел 4-5: сервер и все клиенты показывают видимое и порождаемое <br>
Раздел 6-7: клиент-ретранслятор показывает комплексную информацию <br>
Раздел 8: несколько клиентов-ретрансляторов <br>

При запуске программ требуемые для их работы IP адреса и порты задаются в командной строке для обеспечения гибкой подстройки к любой сети.

В аргументах командной строки сервера можно записать число задач для выполнения. Число 1 не подходит, т.к. по условию должен происходить обмен между программистами. Также аргумент не может превышать определённую константу, чтобы правильно инициализировать массив задач. Константы в коде можно менять в блоке с define.

Для обеспечения корректного взаимодействия сетевых приложений и существующих в них процессов используются неименованные семафоры (имитирующие работу мьютексов): для регулирования доступа к пуллу задач и для нехаотичного вывода информации о каждой задаче по завершению очередного взаимодействия.

Разработанное приложение позволяет задавать ip-адрес сервера, к которому подключаются клиенты.

Тестовые прогоны (скриншоты) прикреплены в соот-х папках (ссылки будут ниже, в нужных разделах)
________________________

### 4-5. сервер и все клиенты показывают видимое и порождаемое <br> ###

#### 4-5.1. Сценарий задачи <br> ####

1 сервер, 3 клиента -- по 1 на каждого программиста (коих по условию варианта всего 3). Запускать код клиента в терминале 3 раза с разными айди программистов.

Аргументы командной строки сервера: исп. файл, порт сервера (по умолчанию равен 7004), число задач (по умолчанию равно MAX_TASK_COUNT = 10, define)

Аргументы командной строки клиента: исп. файл, номер программиста, ip сервера, порт сервера

На сервере хранится пулл задач, для каждой задачи устанавливаются флаги для понимания текущего процесса: для выполнения, для проверки, выполненные (корректно или некорректно).

Структура данных Задача содержит id (чтобы различать задачи между собой), id выполняющего (чтобы можно было 1) вывести информацию для наглядности 2) передать задачу в случае ошибок на исправление именно тому программисту, который эту задачу изначально выполнял), id проверяющего (для вывода и повторной проверки).

Система заканчивает работу, когда число выполненных задач будет равно числу всех задач, заявленных в командной строке (или в константах).

Взаимодействие сервера с клиентами происходит через обмен запросов-ответов -- создана структура со статусами (кодами) запросов/ответов, в которой также хранится значение задачи (чтобы 1) программисты видели айди, 2) проверяющие проставляли задаче статус в зависимости от результата проверки: она реализована в клиенте через rand() % 2).

Добавлены sleep() для менее хаотичного вывода в консоль.

При завершении сервера сигналом SIGINT удалются семафоры и закрывается сокет сервера. Выводится лог итога.

#### 4-5.2. Код с комментариями <br> ####

[Задание на 4-5 балла](https://github.com/kseniag03/OS-IHW-3/tree/master/4-5) <br>
[Задание на 4-5 балла, клиент](https://github.com/kseniag03/OS-IHW-3/blob/master/4-5/client.c) <br>
[Задание на 4-5 балла, сервер](https://github.com/kseniag03/OS-IHW-3/blob/master/4-5/server.c) <br>
________________________

### 6-7. клиент-ретранслятор (а.к.а. клиент-логгер) показывает комплексную информацию <br> ###

#### 6-7.1. Сценарий задачи <br> ####

Сервер теперь прослушивает два порта: один -- для получения запросов от клиентов-программистов, второй -- для получения запроса от клиента-ретранслятора на выдачу сообщений. При работе со вторым сокетом клиента также предусмотрены потоки (для дальнейшего расширения, чтобы можно было подключать несколько клиентов-логгеров на чтение информации).

Порты должны быть разными, чтобы логгер мог получать именно сообщения.

Клиент-логгер запрашивает у сервера сообщения для вывода. Теперь помимо printf у сервера происходит передача информации клиенту-логгеру.

Добавлены семафоры-"мьютексы" для отдельных потоков (ограничение доступа к общему ресурсу-сокету)

#### 6-7.2. Код с комментариями <br> ####

[Задание на 6-7 баллов](https://github.com/kseniag03/OS-IHW-3/tree/master/6-7) <br>
[Задание на 6-7 баллов, клиент-программист](https://github.com/kseniag03/OS-IHW-3/blob/master/6-7/client.c) <br>
[Задание на 6-7 баллов, сервер](https://github.com/kseniag03/OS-IHW-3/blob/master/6-7/server.c) <br>
[Задание на 6-7 баллов, клиент-логгер](https://github.com/kseniag03/OS-IHW-3/blob/master/6-7/logger.c) <br>
________________________

### 8. несколько клиентов-ретрансляторов <br> ###

#### 8.1. Сценарий задачи <br> ####

Та же программа, что и на 6-7 баллов, но теперь поменялась константа, ограничивающая число прослушиваний клиентов-логгеров у сервера (в прошлой программе она ограничивалась единицей).

#### 8.2. Код с комментариями <br> ####

[Задание на 8 баллов](https://github.com/kseniag03/OS-IHW-3/tree/master/8) <br>
[Задание на 8 баллов, клиент-программист](https://github.com/kseniag03/OS-IHW-3/blob/master/8/client.c) <br>
[Задание на 8 баллов, сервер](https://github.com/kseniag03/OS-IHW-3/blob/master/8/server.c) <br>
[Задание на 8 баллов, клиент-логгер](https://github.com/kseniag03/OS-IHW-3/blob/master/8/logger.c) <br>
